<!-- HERO -->
<section class="blog-hero" aria-label="Cabeçalho do blog">
  <div class="container">
    <h1 class="title-xl blog-hero__title">{{ pageTitle() }}</h1>
    @if (pageSubtitle()) {
      <p class="intro blog-hero__intro">{{ pageSubtitle() }}</p>
    }

    <div class="search">
      <input type="search" [value]="search()" (input)="onSearchInput($event)" [placeholder]="pagePlaceholder()" [attr.aria-label]="pagePlaceholder()" />
      @if (loading()) {
        <span class="search__spinner" aria-hidden="true"></span>
      }
    </div>
  </div>
</section>

<!-- LISTAGEM -->
<section class="section blog-list">
  <div class="container">
    <div class="row">
      <div class="col-12 col-lg-12 col-xl-10 offset-xl-1">
        @if (error()) {
          <div class="error">{{ error() }}</div>
        }

        <!-- GRID DE POSTS -->
        <div class="grid grid--cards">
          <!-- PRIMEIRO CARREGAMENTO (só skeletons) -->
          @if (loading() && posts().length === 0) {
            @for (i of skeletonArray(); track i) {
              <article class="post-card post-card--skeleton" aria-hidden="true">
                <div class="post-card__link">
                  <figure class="post-card__media">
                    <app-skeleton variant="rect" [width]="'100%'" [height]="200" [radius]="8"></app-skeleton>
                  </figure>

                  <div class="post-card__body">
                    <!-- kicker -->
                    <app-skeleton variant="rect" [width]="'30%'" [height]="12" [radius]="4"></app-skeleton>
                    <div style="height: 10px"></div>
                    <!-- title (2 linhas) -->
                    <app-skeleton variant="text" [lines]="2" [lineHeight]="16" [gap]="10" [lastLineWidth]="'70%'" [width]="'100%'" [radius]="4"></app-skeleton>
                    <div style="height: 10px"></div>
                    <!-- excerpt (2 linhas) -->
                    <app-skeleton variant="text" [lines]="2" [lineHeight]="14" [gap]="8" [lastLineWidth]="'60%'" [width]="'100%'" [radius]="4"></app-skeleton>
                  </div>
                </div>
              </article>
            }
          }

          <!-- CARDS REAIS -->
          @for (p of posts(); track p.slug) {
            <article class="post-card">
              <a [routerLink]="['/blog', p.slug]" class="post-card__link">
                <figure class="post-card__media">
                  <img [src]="img(p)" alt="" loading="lazy" decoding="async" />
                </figure>

                <div class="post-card__body">
                  @if (p.subtitle) {
                    <p class="post-card__kicker">{{ p.subtitle }}</p>
                  }
                  <h3 class="post-card__title">
                    {{ p.title }}
                    <span class="post-card__arrow" aria-hidden="true">
                      <svg width="16" height="16" viewBox="0 0 24 24" fill="none">
                        <path d="M7 17L17 7M17 7H9M17 7v8" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
                      </svg>
                    </span>
                  </h3>
                  @if (p.featuredText) {
                    <p class="post-card__excerpt">{{ p.featuredText }}</p>
                  }
                </div>
              </a>
            </article>
          }

          <!-- LOAD MORE: ENQUANTO BUSCA, MOSTRA 3 SKELETONS AO FINAL -->
          @if (loading() && posts().length > 0) {
            @for (i of loadMoreSkeletons(); track i) {
              <article class="post-card post-card--skeleton" aria-hidden="true">
                <div class="post-card__link">
                  <figure class="post-card__media">
                    <app-skeleton variant="rect" [width]="'100%'" [height]="200" [radius]="8"></app-skeleton>
                  </figure>
                  <div class="post-card__body">
                    <app-skeleton variant="rect" [width]="'45%'" [height]="12" [radius]="4"></app-skeleton>
                    <div style="height: 10px"></div>
                    <app-skeleton variant="text" [lines]="2" [lineHeight]="16" [gap]="10" [lastLineWidth]="'65%'" [width]="'100%'" [radius]="4"></app-skeleton>
                  </div>
                </div>
              </article>
            }
          }
        </div>

        <!-- BOTÃO CARREGAR MAIS -->
        @if (canLoadMore()) {
          <div class="load-more">
            <button [disabled]="loading()" class="btn btn--primary" (click)="loadMore()">
              <img src="/images/icons/arrow-down.svg" alt="" />
              {{ loading() ? 'Carregando...' : pageFieldLabel() }}
            </button>
          </div>
        }
      </div>
    </div>
  </div>
</section>
